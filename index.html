<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Weihnachtsgeschenke-Shop</title>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="page-catalog">
  <h1>{{ title }}</h1>

  <!-- Suche -->
  <input
    type="text"
    placeholder="Suche..."
    v-model="search"
    data-testid="search-input"
  >

  <!-- Produkte -->
  <div
    class="product"
    v-for="product in filteredProducts"
    :key="product.id"
    data-testid="product"
  >
    <img
      :src="product.image"
      width="150"
      data-testid="product-image"
    >

    <h3 data-testid="product-title">
      {{ product.title }}
    </h3>

    <p data-testid="product-price">
      {{ product.price.toFixed(2) }} €
    </p>

    <button
      @click="orderProduct(product)"
      data-testid="product-order"
    >
      +
    </button>

    <span>
      {{ cart.find(p => p.id === product.id)?.quantity || 0 }}
    </span>

    <button
      @click="removeProduct(product)"
      :disabled="!cart.find(p => p.id === product.id)"
    >
      −
    </button>
  </div>

  <hr>

  <!-- Warenkorb Summary -->
  <p>
    Produkte:
    <span data-testid="cart-total-positions">
      {{ cartTotalPositions }}
    </span>
  </p>

  <p>
    Stück:
    <span data-testid="cart-total-items">
      {{ cartTotalItems }}
    </span>
  </p>

  <p>
    Gesamt:
    <span data-testid="cart-total-price">
      {{ cartGrossPrice.toFixed(2) }} €
    </span>
  </p>

  <!-- Stripe Checkout (Redirect von PHP) -->
  <form
    action="php/stripe.php"
    method="POST"
  >
    <input
      type="hidden"
      name="amount"
      :value="cartGrossPrice.toFixed(2)"
    >

    <button type="submit">
      Bestellung abschicken
    </button>
  </form>

  <!-- Link zur Warenkorb-Seite -->
  <p>
    <a href="cart.html">Zum Warenkorb</a>
  </p>

  <!-- Message Bar -->
  <div id="message-bar">
    <div
      class="message"
      v-for="(msg, i) in messages"
      :key="i"
    >
      {{ msg }}
    </div>
  </div>
</div>

<script src="js/app.js"></script>
</body>
</html>
