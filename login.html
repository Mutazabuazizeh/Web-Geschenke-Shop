<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>

<div id="page-login">
  <h1>Login</h1>

  <input v-model="username" placeholder="Username">
  <input v-model="password" type="password" placeholder="Password">

  <button @click="login">Login</button>

  <p v-if="error" style="color:red">Login fehlgeschlagen</p>
</div>

<script>
const { createApp } = Vue

createApp({
  data() {
    return {
      username: '',
      password: '',
      error: false
    }
  },
  methods: {
    login() {
      fetch('php/login.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: this.username,
          password: this.password
        })
      })
      .then(r => {
        if (!r.ok) throw new Error()
        return r.json()
      })
      .then(data => {
        localStorage.setItem('user', JSON.stringify(data.user))
        window.location.href = 'index.html'
      })
      .catch(() => this.error = true)
    }
  }
}).mount('#page-login')
</script>

</body>
</html>
